---
title: Linux文件权限管理
author: Jianghe
top: true
hide: false
mathjax: false
toc: true
date: 2021-07-07 22:23:35
img:
summary: 
    - chattr
    - s权限 
    - 黏着位 t
categories: Linux
tags: 
    - 权限管理
keywords:
---
## 普通权限

在 Linux 中使用 `ls -l` 命令可以查看一个文件的属性以及所属的用户和组：

```shell
$ ls -l Blog
drwxr-xr-x  9 root root 4096  7月  6 11:46 Blog
```

* 第一个字符表示文件类型，实例中`Blog` 文件第一个属性是`d` ，表示它的文件类型是目录。Linux 中文件类型有：

  | 字符 | 含义                                                         |
  | :--: | :----------------------------------------------------------- |
  |  -   | 普通文件(纯文本文件，二进制文件，各种压缩文件)               |
  |  d   | 目录文件(`Linux` 中一切皆文件，目录文件即`Windows`中的目录)  |
  |  c   | 字符设备文件(串行端口的接口设备，如键盘、鼠标)               |
  |  b   | 块设备文件(存储数据以供系统存取的接口设备，如硬盘)           |
  |  l   | 链接文件(通过`ln -s`命令创建的软链接，类似Win下的快捷方式)   |
  |  s   | 套接字文件(常用在网络数据连接，启动一个程序来监听客户端的要求，客户端就可以通过套接字来进行数据通信。) |
  |  p   | 管道文件 FIFO (特殊的文件类型，FIFO 即`first-in-first-out`，主要用于解决多个程序同时存取同一文件所造成的错误) |

* 接下来的字符3个一组，依次表示文件所有者、所属组和其他人对文件的读(r)、写(w)、执行(x)权限，没有相应权限则用`-`字符表示。如实例`Blog`文件中,所有者对文件可读可写可执行，所属组对文件可读可执行，其他人对文件可读可执行

  <img src="https://raw.githubusercontent.com/Jianghe232/tuchuang/main/Typora/%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90.png" style="zoom:100%;" />

* 两个`root` ,前一个表示属主（该文件所有者）为 root，后一个表示属组为 root

  > 在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。

* 可以使用命令`chown, chgrp` 来更改文件的属主和属组

  ```shell
  # 添加 -R 选项表示递归修改
  chown [–R] 属主名 文件名
  chown [-R] 属主名:属组名 文件名
  chgrp [-R] 属组名 文件名
  ```

  

 ## chmod：更改文件属性

对于一个文件，用户可能有三种身份，文件所有者（user）、文件所属组的成员（group）、其他人（others）。用户对文件有三种权限，读(r)、写(w)、执行(x)。Linux 文件属性有两种设置方法，一种是通过数字，一种是通过符号。

* 通过符号修改权限

  ```shell
  # 给身份为 user 的用户添加对文件的执行权限
  chmod u+x 文件名
  # 删除身份为 others 的用户对文件的读权限
  chmod o-r 文件名
  # 给身份为 group 的用户添加对文件的写权限
  chmod g+w 文件名
  # 直接设定 others 的权限
  chmod o=rw 文件名
  # 多步权限修改可以同时进行，如给user和other添加读、写权限，给group删除写权限
  chmod uo+rw,g-x 文件名
  # 当不指定具体用户或使用 a 参数，权限修改是对于所有人
  # 如删除所有人对文件的读权限
  chmod -r 文件名；等同于 chmod a-r 文件名;
  ```

  |  命令   |      身份      |    操作     |    权限     | 文件或目录 |
  | :-----: | :------------: | :---------: | :---------: | :--------: |
  | `chmod` | [ u  g  o  a ] | [ +  -  = ] | [ r  w  x ] |  filename  |

  

* 通过数字修改权限

  一个用户对文件的三种权限，与数字对应为：r = 4, w = 2, x = 1；每种身份对文件权限则是各自的三种权限相加，如：

  -rwxrwx--- 对应于数字时是：

  * user = rwx = 4 + 2 + 1 = 7
  * group = rwx = 4 + 2 + 1 = 7
  * others = --- = 0 + 0 + 0 = 0
  * 所以该文件的权限数字就是 770

  要设置文件权限为 -rwxr-xr-x 命令为：`chmod 755 文件名` 

* 通过`umask`命令可以设置新建文件的默认权限

  



## 特殊权限

### s权限 （SetUID,SetGID）

当可执行文件具有 S 权限时，执行文件时，将以这个文件的属主（SetUID）或属组（SetGID）身份执行。

1. SetUID，对属主设置 s 权限，数字表示为 4

   ```shell
   chmod u+s 文件名  或  chmod 4777 文件名
   ```

   > 我们利用umask知道权限的设置是四位数，后三位是ugo对应的属性，首位就是特殊位权限的表示，SetUID的权限位是4，因此可以用chmod 4777 xxx设置s权限
   
    **例如：passwd 命令就具有 s 权限，因此普通用户能修改自己的密码**
   
2. SetGID, 对属组设置 s 权限，数字表示为2

   ```shell
   chmod g+s 文件名 或 chmod 2777 文件名
   ```

### 黏着位 t

t 一般针对权限是 777 的目录文件设置，用于实现共享目录。如果文件设置了 t 权限，则只有属主有删除文件的权限。（root 除外）

* 对 others 设置权限 t，数字表示为 1

  ```shell
  chmod o+t 文件名  或 chmod 1777 文件名
  ```

  例如：**Linux中存放临时文件夹的tmp目录就有t权限**



## chattr 设置隐藏属性

管理 Linux 系统中的文件，除了可以设定普通权限和特殊权限外，还可以利用`chattr`命令设置文件和目录具有的一些隐藏属性。**只有root用户可以使用**

* `chattr` 命令基本格式：

  `chattr [+-=] [属性] 文件名`

  | 属性选项 | 功能                                                         |
  | :------: | ------------------------------------------------------------ |
  |    i     | 如果对文件设置 i 属性，那么不允许对文件进行删除、改名，也不能添加和修改数据；<br/>如果对目录设置 i 属性，那么只能修改目录下文件中的数据，但不允许建立和删除文件； |
  |    a     | 如果对文件设置 a 属性，那么只能在文件中増加数据，但是不能删除和修改数据；<br/>如果对目录设置 a 属性，那么只允许在目录中建立和修改文件，但是不允许删除文件；   |
  |    u     | 设置此属性的文件或目录，在删除时，其内容会被保存，以保证后期能够恢复，常用来防止意外删除文件或目录。 |
  |    s     | 和 u 相反，删除文件或目录时，会被彻底删除（直接从硬盘上删除，然后用 0 填充所占用的区域），不可恢复。 |

* `lsattr` 查看文件隐藏权限
